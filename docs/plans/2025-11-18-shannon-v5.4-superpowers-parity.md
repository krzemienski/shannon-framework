---
title: Shannon v5.4 ‚Äì Superpowers Parity & Large-Input Safeguards
date: 2025-11-18
version: 5.4.0
status: design-approved
---

# Shannon v5.4 Parity + Safeguards Plan

## 1. Current Repo Inventory

### 1.1 File Tree Snapshot (high-level)

```
agents/                 # 24 agent specs (ANALYZER, WAVE_COORDINATOR, etc.)
commands/               # 19 commands (spec, wave, do, exec, task, ultrathink‚Ä¶)
core/                   # 9 behavioral frameworks (SPEC_ANALYSIS, FORCED_READING‚Ä¶)
hooks/                  # session_start, user_prompt_submit, precompact, post_tool_use, stop
skills/                 # 100+ skills (phase-planning, functional-testing, etc.)
docs/                   # orchestration guides, plans, reference docs
install_*.sh            # local + universal installers
tests/                  # orchestration + hook + integration scaffolding
dashboard/, server/, orchestration/  # runtime subsystems
```

### 1.2 Interaction / Import Graph (conceptual)

```
commands/*.md  ‚îÄ‚îê
               ‚îú‚îÄ> skills/*/SKILL.md  ‚îÄ‚îÄ> core/*.md  (referenced via paths, consumed at runtime)
agents/*.md ‚îÄ‚îÄ‚îÄ‚îò

hooks/session_start.sh   ‚îÄ‚îÄ> embeds skills/using-shannon/SKILL.md (meta instructions)
hooks/user_prompt_submit.py  ‚îÄ‚îÄ> Serena (.serena/) North Star + wave state
hooks/precompact.py  ‚îÄ‚îÄ> orchestrator checkpoint APIs
hooks/post_tool_use.py ‚îÄ‚îÄ> scans test files before write/edit

install_local.sh / install_universal.sh ‚îÄ‚îÄ> orchestrate copying commands/skills/hooks into editor envs
```

> **Implication:** parity changes must touch commands + skills + hooks, and keep installer + docs in sync.

## 2. Reference Repo Analysis (superpowers)

| Superpowers Component | Purpose | Shannon Status | Gap |
|----------------------|---------|----------------|-----|
| `write-plan` command + `writing-plans` skill | Generates extremely detailed implementation plans with file paths, code snippets, and verification steps | Only `phase-planning` (high-level) | Need Shannon-flavored writing plan command/skill + doc automation |
| `execute-plan` command + `executing-plans` skill | Executes plan task-by-task with gate checks | /shannon:exec does validation but no explicit plan-driven workflow | Add execution-plans skill + command that consumes docs/plans |
| `brainstorm` command + `brainstorming` skill | Idea/worktree exploration before planning | No Shannon equivalent | Introduce brainstorming skill/command tied to wave planning |
| `systematic-debugging`, `root-cause-tracing` skills | Templated checklists for debugging | Ultrathink exists but skill docs absent | Create skills to reinforce ultrathink command + provide reusable checklists |
| `writing-skills`, `sharing-skills` | Document skill usage + propagation | We have using-shannon but no creation guide | Optional stretch goal |

## 3. Enhancement Goals (v5.4)

### Goal A ‚Äì Command Parity (write-plan, execute-plan, brainstorm)
1. **Commands**: add `/shannon:brainstorm`, `/shannon:write_plan`, `/shannon:execute_plan`.
2. **Skills**: new skill directories with Shannon tone + references to existing assets (phase-planning, wave-orchestration, functional-testing).
3. **Doc automation**: writing plan saves into `docs/plans/YYYY-MM-DD-<slug>.md` with Shannon plan header that references `/shannon:execute_plan`.
4. **Commander doc updates**: update `docs/COMMAND_ORCHESTRATION.md`, `skills/using-shannon/SKILL.md`, README quick start, CHANGELOG, V5 release notes.
5. **Tests**: add lightweight markdown validation (CI) + new scenario doc in `tests/` describing plan-hand-off.

### Goal B ‚Äì Systematic Debugging & Root Cause Skills
1. Create `skills/systematic-debugging/SKILL.md` & `skills/root-cause-analysis/SKILL.md`.
2. Wire `/shannon:ultrathink` command to explicitly delegate to these skills (update command doc).
3. Add quick-reference sections in `core/FORCED_READING_PROTOCOL.md` + `docs/COMMAND_ORCHESTRATION.md`.
4. Provide test fixture or doc verifying usage (e.g., `tests/README.md` update, optional scripted check).

### Goal C ‚Äì Large Input Forced-Reading Sentinel
1. New skill: `skills/forced-reading-sentinel/SKILL.md` describing automatic activation when prompts/files exceed thresholds.
2. Update `hooks/user_prompt_submit.py`:
   - Detect prompt size (characters + line count).
   - Detect probable large file references (e.g., ```` ```filename``, `L123|` patterns, or explicit `lines 1-500`).
   - If thresholds exceeded, emit reminder referencing sentinel skill & forced reading protocol.
3. Consider optional detection of `input_data["files"]` if available (fall back to prompt scanning).
4. Update `hooks/README.md`, `core/FORCED_READING_PROTOCOL.md`, and `skills/using-shannon/SKILL.md` to mention sentinel.
5. Add regression test `tests/hooks/test_user_prompt_submit.py` verifying sentinel message for large prompt.

### Goal D ‚Äì Release & Quality
1. Version bump to **5.4.0** (`.claude-plugin/plugin.json`, README badge, CHANGELOG).
2. Update release docs: `V5_RELEASE_NOTES.md`, `MASTER_V5_SUMMARY.md`, `STATUS_PRODUCTION_READY.md`.
3. Run `./test_universal_install.sh` + targeted hook unit tests.
4. Ensure new commands referenced in installers (if command count mentioned) and documentation.

## 4. Implementation Plan Overview

| Step | Deliverable | Files |
|------|-------------|-------|
| 1 | Document new commands & skills (brainstorm, write-plan, execute-plan) | `commands/*.md`, `skills/*/SKILL.md`, `docs/COMMAND_ORCHESTRATION.md`, README |
| 2 | Add systematic-debugging + root-cause-analysis skills + update ultrathink command | `skills/systematic-debugging`, `skills/root-cause-analysis`, `commands/ultrathink.md`, `docs/V5_RELEASE_NOTES.md` |
| 3 | Forced Reading Sentinel skill + hook logic + tests | `skills/forced-reading-sentinel`, `hooks/user_prompt_submit.py`, `hooks/README.md`, `core/FORCED_READING_PROTOCOL.md`, `tests/hooks/test_user_prompt_submit.py`, `hooks/hooks.json` (description bump) |
| 4 | Docs & orchestration updates | `skills/using-shannon/SKILL.md`, `docs/COMMAND_ORCHESTRATION.md`, `README.md`, `CHANGELOG.md`, `VERSION_AUDIT_COMPLETE.md` |
| 5 | Release tasks | `.claude-plugin/plugin.json`, release docs, installers (if counts referenced), run tests |

## 5. Large-Input Sentinel Requirements

- **Thresholds**:
  - Characters ‚â• 10,000 **OR**
  - Lines ‚â• 400 **OR**
  - Prompt references explicit ranges like "`lines 1-500`", `L1|` metadata, or code fences exceeding 200 lines.
- **Response**: print block _before_ prompt goes through:
  ```
  üìè **Forced Reading Sentinel Activated**
  File(s)/prompt exceed Shannon thresholds. Follow forced-reading-sentinel skill:
  1. Read entire file sequentially without skipping.
  2. Summarize sections verbally.
  3. Confirm comprehension before modifications.
  ```
- **Skill Activation**: mention `forced-reading-sentinel` + `FORCED_READING_PROTOCOL`.
- **Logging**: errors go to stderr, do not block prompt.

## 6. Testing Strategy

1. **Hook Unit Test**: simulate large prompt input; assert sentinel message emitted.
2. **Doc Consistency**: ensure command list (README, COMMAND_ORCHESTRATION) counts new commands.
3. **Installer Checks**: run `./test_install.sh` & `./test_universal_install.sh`.
4. **Version Audit**: run grep to confirm `5.4.0` references consistent.

## 7. Acceptance Criteria

- Parity commands/skills exist with Shannon flavor.
- Ultrathink command explicitly references new debugging skills.
- Sentinel hook fires based on thresholds + documented skill.
- Documentation + release artifacts updated to 5.4.0.
- Installers/tests pass without regression.

---

**Approval Checklist**
- [ ] Design reviewed vs superpowers feature list
- [ ] Thresholds acceptable (10k chars / 400 lines)
- [ ] Version bump to 5.4.0 approved
